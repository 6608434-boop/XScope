#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
================================================================================
–§–ê–ô–õ: core/cli/init_db.py
–ù–ê–ó–ù–ê–ß–ï–ù–ò–ï: CLI –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–ê–í–¢–û–†: Oliver Vance
–î–ê–¢–ê: 2026-02-15

–û–ü–ò–°–ê–ù–ò–ï:
    –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è Flask CLI: flask init-db
    –°–æ–∑–¥–∞—ë—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
    flask init-db

–ò–°–¢–û–†–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô:
    2026-02-15 - Oliver - —Å–æ–∑–¥–∞–Ω–∏–µ
================================================================================
"""

import click
from flask.cli import with_appcontext
import logging

from core.database import init_db

logger = logging.getLogger(__name__)


@click.command('init-db')
@with_appcontext
def init_db_command():
    """
    –°–æ–∑–¥–∞—ë—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

    –ü—Ä–∏–º–µ—Ä:
        flask init-db
    """
    click.echo('üóÑÔ∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...')

    try:
        init_db()
        click.echo('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞!')
    except Exception as e:
        click.echo(f'‚ùå –û—à–∏–±–∫–∞: {e}', err=True)
        raise


# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ —Å —Ñ–ª–∞–≥–æ–º --force –¥–ª—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è
@click.command('reset-db')
@click.option('--force', is_flag=True, help='–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è')
@with_appcontext
def reset_db_command(force):
    """
    –£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∏ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–Ω–æ–≤–æ.
    –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è!

    –ü—Ä–∏–º–µ—Ä:
        flask reset-db --force
    """
    if not force:
        click.echo('‚ö†Ô∏è –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ --force –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.')
        return

    click.echo('üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü...')

    try:
        from core.database.create_tables import drop_all_tables
        drop_all_tables()
        click.echo('‚úÖ –¢–∞–±–ª–∏—Ü—ã —É–¥–∞–ª–µ–Ω—ã')

        click.echo('üîÑ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∑–∞–Ω–æ–≤–æ...')
        init_db()
        click.echo('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞!')

    except Exception as e:
        click.echo(f'‚ùå –û—à–∏–±–∫–∞: {e}', err=True)
        raise