#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
================================================================================
–§–ê–ô–õ: services/profile/get_all.py
–ù–ê–ó–ù–ê–ß–ï–ù–ò–ï: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –±–æ—Ç–æ–≤
–ê–í–¢–û–†: Oliver Vance
–î–ê–¢–ê: 2026-02-14

–û–ü–ò–°–ê–ù–ò–ï:
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π —Å —É—á—ë—Ç–æ–º feature flags.
    –ï—Å—Ç—å –≤–µ—Ä—Å–∏—è –¥–ª—è API –∏ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
    from services.profile.get_all import get_all_profiles, get_all_profiles_for_api

    # –î–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    profiles = get_all_profiles()

    # –î–ª—è API (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π)
    api_profiles = get_all_profiles_for_api()

–§–£–ù–ö–¶–ò–ò:
    get_all_profiles() - –≤—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏ (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏)
    get_all_profiles_for_api() - —Ç–æ–ª—å–∫–æ –≤–∫–ª—é—á—ë–Ω–Ω—ã–µ, –¥–ª—è API

–ò–°–¢–û–†–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô:
    2026-02-14 - Oliver - —Å–æ–∑–¥–∞–Ω–∏–µ
================================================================================
"""

from typing import List, Dict, Any

from models.profile import BotProfile
from config.features import FeatureConfig

import logging

logger = logging.getLogger(__name__)


def get_all_profiles() -> List[Dict[str, Any]]:
    """
    –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.

    Returns:
        List[Dict]: –í—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏ –∏–∑ –ë–î
    """
    logger.info("üìã –ó–∞–ø—Ä–æ—Å –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π")

    profiles = BotProfile.get_all()
    logger.debug(f"üìä –ù–∞–π–¥–µ–Ω–æ {len(profiles)} –ø—Ä–æ—Ñ–∏–ª–µ–π")

    return profiles


def get_all_profiles_for_api() -> List[Dict[str, Any]]:
    """
    –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∫–ª—é—á—ë–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è API.

    Returns:
        List[Dict]: –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è JSON –æ—Ç–≤–µ—Ç–∞
    """
    logger.info("üåê –ó–∞–ø—Ä–æ—Å –ø—Ä–æ—Ñ–∏–ª–µ–π –¥–ª—è API")

    # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–∫–ª—é—á—ë–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏
    profiles = BotProfile.get_all_enabled()

    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è API
    api_profiles = []
    for p in profiles:
        api_profiles.append({
            'id': p['bot_id'],
            'name': p['bot_name'],
            'avatar': p['avatar'],
            'description': p['description']
        })

    logger.debug(f"üìä –î–ª—è API –¥–æ—Å—Ç—É–ø–Ω–æ {len(api_profiles)} –ø—Ä–æ—Ñ–∏–ª–µ–π")
    return api_profiles


def get_enabled_profile_ids() -> List[str]:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ ID –≤–∫–ª—é—á—ë–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π.

    Returns:
        List[str]: ['oliver', 'will', 'isaac', ...]
    """
    return FeatureConfig.get_enabled_profiles()


def count_enabled_profiles() -> int:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∫–ª—é—á—ë–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π.

    Returns:
        int: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
    """
    return len(get_enabled_profile_ids())