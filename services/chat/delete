#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
================================================================================
–§–ê–ô–õ: services/chat/delete.py
–ù–ê–ó–ù–ê–ß–ï–ù–ò–ï: –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞
–ê–í–¢–û–†: Oliver Vance
–î–ê–¢–ê: 2026-02-14

–û–ü–ò–°–ê–ù–ò–ï:
    –£–¥–∞–ª—è–µ—Ç —á–∞—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π:
    - –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —á–∞—Ç
    - –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º

–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
    from services.chat.delete import delete_chat

    success = delete_chat(user_id=1, chat_id=123)

–§–£–ù–ö–¶–ò–ò:
    delete_chat(user_id, chat_id) - —É–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞

–ò–°–¢–û–†–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô:
    2026-02-14 - Oliver - —Å–æ–∑–¥–∞–Ω–∏–µ
================================================================================
"""

from models.chat import Chat

import logging

logger = logging.getLogger(__name__)


def delete_chat(user_id: int, chat_id: int) -> bool:
    """
    –£–¥–∞–ª—è–µ—Ç —á–∞—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤.

    Args:
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–ª–∞–¥–µ–ª–µ—Ü)
        chat_id: ID —á–∞—Ç–∞

    Returns:
        bool: True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ

    Raises:
        ValueError: –ï—Å–ª–∏ —á–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
        ValueError: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü
    """
    logger.info(f"üóëÔ∏è –ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ {chat_id} –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")

    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —á–∞—Ç–∞
    chat = Chat.get_by_id(chat_id)
    if not chat:
        error_msg = f"–ß–∞—Ç {chat_id} –Ω–µ –Ω–∞–π–¥–µ–Ω"
        logger.error(f"‚ùå {error_msg}")
        raise ValueError(error_msg)

    # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
    if chat['user_id'] != user_id:
        error_msg = f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º —á–∞—Ç–∞ {chat_id}"
        logger.error(f"‚ùå {error_msg}")
        raise ValueError(error_msg)

    # 3. –£–¥–∞–ª—è–µ–º —á–∞—Ç (–∫–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
    success = Chat.delete(chat_id)

    if success:
        logger.info(f"‚úÖ –ß–∞—Ç {chat_id} —É–¥–∞–ª—ë–Ω")
    else:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ë–î –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —á–∞—Ç–∞ {chat_id}")

    return success