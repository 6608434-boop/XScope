#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
================================================================================
–§–ê–ô–õ: prompts/__init__.py
–ù–ê–ó–ù–ê–ß–ï–ù–ò–ï: –ó–∞–≥—Ä—É–∑—á–∏–∫ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
–ê–í–¢–û–†: Oliver Vance
–î–ê–¢–ê: 2026-02-15

–û–ü–ò–°–ê–ù–ò–ï:
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã –∏–∑ .txt —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–µ prompts/
    –∏ –¥–µ–ª–∞–µ—Ç –∏—Ö –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä—å PROMPTS.

–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
    from prompts import PROMPTS
    oliver_prompt = PROMPTS['oliver']

–ò–°–¢–û–†–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô:
    2026-02-15 - Oliver - —Å–æ–∑–¥–∞–Ω–∏–µ
================================================================================
"""

import os
from pathlib import Path
import logging

logger = logging.getLogger(__name__)

# –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏
PROMPTS_DIR = Path(__file__).parent

# –°–ª–æ–≤–∞—Ä—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
PROMPTS = {}


def load_prompt(bot_id: str) -> str:
    """
    –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–æ—Ç–∞ –∏–∑ .txt —Ñ–∞–π–ª–∞.

    Args:
        bot_id: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–æ—Ç–∞ ('oliver', 'will', ...)

    Returns:
        str: –¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞

    Raises:
        FileNotFoundError: –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
    """
    file_path = PROMPTS_DIR / f"{bot_id}.txt"

    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read().strip()
            logger.debug(f"–ó–∞–≥—Ä—É–∂–µ–Ω –ø—Ä–æ–º–ø—Ç –¥–ª—è {bot_id} ({len(content)} —Å–∏–º–≤–æ–ª–æ–≤)")
            return content
    except FileNotFoundError:
        logger.error(f"‚ùå –§–∞–π–ª –ø—Ä–æ–º–ø—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}")
        raise
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–ø—Ç–∞ {bot_id}: {e}")
        raise


def load_all_prompts() -> dict:
    """
    –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã –∏–∑ –ø–∞–ø–∫–∏ prompts/.

    Returns:
        dict: –°–ª–æ–≤–∞—Ä—å {bot_id: prompt_text}
    """
    prompts = {}

    # –ò—â–µ–º –≤—Å–µ .txt —Ñ–∞–π–ª—ã
    txt_files = list(PROMPTS_DIR.glob("*.txt"))

    for file_path in txt_files:
        if file_path.name == '__init__.py':  # –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∞–º __init__
            continue

        bot_id = file_path.stem  # –∏–º—è —Ñ–∞–π–ª–∞ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

        try:
            prompts[bot_id] = load_prompt(bot_id)
        except Exception as e:
            logger.error(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å {file_path.name}: {e}")
            continue

    logger.info(f"üìö –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(prompts)} –ø—Ä–æ–º–ø—Ç–æ–≤")
    return prompts


# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
PROMPTS = load_all_prompts()


def get_prompt(bot_id: str, default: str = None) -> str:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –±–æ—Ç–∞ –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

    Args:
        bot_id: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–æ—Ç–∞
        default: –ó–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –ø—Ä–æ–º–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

    Returns:
        str: –¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –∏–ª–∏ default
    """
    return PROMPTS.get(bot_id, default)


def reload_prompt(bot_id: str) -> bool:
    """
    –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–æ—Ç–∞.

    Args:
        bot_id: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–æ—Ç–∞

    Returns:
        bool: True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω
    """
    try:
        PROMPTS[bot_id] = load_prompt(bot_id)
        logger.info(f"üîÑ –ü—Ä–æ–º–ø—Ç {bot_id} –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω")
        return True
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ {bot_id}: {e}")
        return False