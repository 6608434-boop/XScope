#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
================================================================================
ФАЙЛ: config/api_keys.py
НАЗНАЧЕНИЕ: Ключи для внешних API сервисов
АВТОР: Oliver Vance
ДАТА: 2026-02-14

ОПИСАНИЕ:
    Этот файл содержит все ключи для подключения к внешним API:
    - DeepSeek API (для AI функций)
    - Telegram Bot API (для будущей интеграции)
    - Google API (для будущей интеграции)

    ВАЖНО: Все ключи загружаются из .env файла!
    Никогда не хардкодьте ключи в этом файле.

ИСПОЛЬЗОВАНИЕ:
    from config.api_keys import APIConfig

    client = DeepSeekClient(APIConfig.DEEPSEEK_API_KEY)

    if APIConfig.TELEGRAM_BOT_TOKEN:
        # Инициализируем Telegram бота
    else:
        logger.warning("Telegram интеграция отключена")

ПАРАМЕТРЫ:
    DEEPSEEK_API_KEY - ключ для DeepSeek API
    DEEPSEEK_API_URL - URL API (можно сменить при необходимости)
    DEEPSEEK_MODEL - модель по умолчанию
    TELEGRAM_BOT_TOKEN - токен Telegram бота
    TELEGRAM_SECRET_TOKEN - секрет для вебхуков
    GOOGLE_CLIENT_ID - для Google API
    GOOGLE_CLIENT_SECRET - секрет Google

ИСТОРИЯ ИЗМЕНЕНИЙ:
    2026-02-14 - Oliver - создание
================================================================================
"""

import os
import logging
from typing import Optional, Dict, Any

# Настройка логирования для этого модуля
logger = logging.getLogger(__name__)


class APIConfig:
    """
    Ключи и настройки для внешних API.

    Все ключи загружаются из переменных окружения.
    Если ключ не задан, соответствующая функция будет отключена
    (с предупреждением в логах).
    """

    # ===== DeepSeek API =====
    # Основной ключ для доступа к DeepSeek
    # Получить можно на platform.deepseek.com
    DEEPSEEK_API_KEY = os.environ.get('DEEPSEEK_API_KEY')

    # URL DeepSeek API (можно изменить при необходимости)
    DEEPSEEK_API_URL = os.environ.get(
        'DEEPSEEK_API_URL',
        'https://api.deepseek.com/v1'  # по умолчанию
    )

    # Модель DeepSeek по умолчанию
    DEEPSEEK_MODEL = os.environ.get('DEEPSEEK_MODEL', 'deepseek-chat')

    # Таймаут для запросов к DeepSeek (в секундах)
    DEEPSEEK_TIMEOUT = int(os.environ.get('DEEPSEEK_TIMEOUT', '30'))

    # Максимальное количество токенов в ответе
    DEEPSEEK_MAX_TOKENS = int(os.environ.get('DEEPSEEK_MAX_TOKENS', '2000'))

    # ===== Telegram Bot API =====
    # Токен Telegram бота (получаем у @BotFather)
    TELEGRAM_BOT_TOKEN = os.environ.get('TELEGRAM_BOT_TOKEN')

    # Секретный токен для вебхуков (защита от поддельных запросов)
    TELEGRAM_SECRET_TOKEN = os.environ.get('TELEGRAM_SECRET_TOKEN')

    # URL для вебхуков (если используется)
    TELEGRAM_WEBHOOK_URL = os.environ.get('TELEGRAM_WEBHOOK_URL')

    # ===== Google API =====
    # Для будущей интеграции с Google Sheets, Drive и т.д.
    GOOGLE_CLIENT_ID = os.environ.get('GOOGLE_CLIENT_ID')
    GOOGLE_CLIENT_SECRET = os.environ.get('GOOGLE_CLIENT_SECRET')
    GOOGLE_PROJECT_ID = os.environ.get('GOOGLE_PROJECT_ID')

    # ===== Другие API =====
    # Для будущих интеграций
    OTHER_API_KEY = os.environ.get('OTHER_API_KEY')
    OTHER_API_URL = os.environ.get('OTHER_API_URL')

    @classmethod
    def check_deepseek(cls) -> bool:
        """
        Проверяет наличие ключа DeepSeek.

        Returns:
            bool: True если ключ есть, иначе False (логирует предупреждение)
        """
        if not cls.DEEPSEEK_API_KEY:
            logger.warning(
                "⚠️ DEEPSEEK_API_KEY не задан. "
                "AI функции будут недоступны."
            )
            return False
        return True

    @classmethod
    def check_telegram(cls) -> bool:
        """
        Проверяет наличие токена Telegram.

        Returns:
            bool: True если токен есть, иначе False
        """
        if not cls.TELEGRAM_BOT_TOKEN:
            logger.info(
                "ℹ️ TELEGRAM_BOT_TOKEN не задан. "
                "Telegram интеграция отключена."
            )
            return False
        return True

    @classmethod
    def get_deepseek_config(cls) -> Dict[str, Any]:
        """
        Возвращает словарь с настройками DeepSeek для клиента.

        Returns:
            Dict[str, Any]: Словарь с параметрами для инициализации клиента

        Пример:
            config = APIConfig.get_deepseek_config()
            client = OpenAI(**config)
        """
        return {
            'api_key': cls.DEEPSEEK_API_KEY,
            'base_url': cls.DEEPSEEK_API_URL,
            'timeout': cls.DEEPSEEK_TIMEOUT,
            'max_retries': 2,  # количество повторных попыток
        }

    @classmethod
    def get_telegram_config(cls) -> Dict[str, Any]:
        """
        Возвращает настройки для Telegram бота.

        Returns:
            Dict[str, Any]: Словарь с параметрами Telegram
        """
        return {
            'token': cls.TELEGRAM_BOT_TOKEN,
            'secret_token': cls.TELEGRAM_SECRET_TOKEN,
            'webhook_url': cls.TELEGRAM_WEBHOOK_URL,
        }

    @classmethod
    def validate_all(cls) -> Dict[str, bool]:
        """
        Проверяет наличие всех ключей и возвращает статус.

        Returns:
            Dict[str, bool]: Словарь с результатами проверки
                Например: {'deepseek': True, 'telegram': False}
        """
        return {
            'deepseek': cls.check_deepseek(),
            'telegram': cls.check_telegram(),
            'google': bool(cls.GOOGLE_CLIENT_ID and cls.GOOGLE_CLIENT_SECRET),
        }