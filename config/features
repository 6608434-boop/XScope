#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
================================================================================
–§–ê–ô–õ: config/features.py
–ù–ê–ó–ù–ê–ß–ï–ù–ò–ï: –§–ª–∞–≥–∏ —Ñ—É–Ω–∫—Ü–∏–π (feature flags) –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
–ê–í–¢–û–†: Oliver Vance
–î–ê–¢–ê: 2026-02-14

–û–ü–ò–°–ê–ù–ò–ï:
    –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–ª–∞–≥–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.
    –ü–æ–∑–≤–æ–ª—è–µ—Ç:
    - –í–∫–ª—é—á–∞—Ç—å/–æ—Ç–∫–ª—é—á–∞—Ç—å –Ω–æ–≤—ã—Ö –±–æ—Ç–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
    - –î–µ–ª–∞—Ç—å A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤—ã–∫–∞—Ç—ã–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    - –ë—ã—Å—Ç—Ä–æ –æ—Ç–∫–ª—é—á–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
    from config.features import FeatureConfig

    if FeatureConfig.ENABLE_WILL:
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –£–∏–ª–ª–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

    if FeatureConfig.MAINTENANCE_MODE:
        return "–°–∞–π—Ç –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏", 503

–ü–ê–†–ê–ú–ï–¢–†–´:
    ENABLE_2FA - –≤–∫–ª—é—á–µ–Ω–∏–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    ENABLE_TELEGRAM - –≤–∫–ª—é—á–µ–Ω–∏–µ Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
    ENABLE_GOOGLE_SHEETS - –≤–∫–ª—é—á–µ–Ω–∏–µ Google Sheets
    ENABLE_* - —Ñ–ª–∞–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –±–æ—Ç–∞
    MAINTENANCE_MODE - —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
    DEBUG_FEATURES - –≤–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

–ò–°–¢–û–†–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô:
    2026-02-14 - Oliver - —Å–æ–∑–¥–∞–Ω–∏–µ
================================================================================
"""

import os
from typing import List, Dict, Any
import logging

logger = logging.getLogger(__name__)


class FeatureConfig:
    """
    –§–ª–∞–≥–∏ —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

    –í—Å–µ —Ñ–ª–∞–≥–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ñ—É–Ω–∫—Ü–∏–π –≤–∫–ª—é—á–µ–Ω—ã (True).
    """

    # ===== –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ =====
    # –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    ENABLE_2FA = os.environ.get('ENABLE_2FA', 'True').lower() == 'true'

    # Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–±–æ—Ç—ã, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
    ENABLE_TELEGRAM = os.environ.get('ENABLE_TELEGRAM', 'False').lower() == 'true'

    # Google Sheets –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)
    ENABLE_GOOGLE_SHEETS = os.environ.get('ENABLE_GOOGLE_SHEETS', 'False').lower() == 'true'

    # ===== AI —Ñ—É–Ω–∫—Ü–∏–∏ =====
    # –û—Å–Ω–æ–≤–Ω–æ–π AI —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
    ENABLE_DEEPSEEK = os.environ.get('ENABLE_DEEPSEEK', 'True').lower() == 'true'

    # –°—Ç—Ä–∏–º–∏–Ω–≥ –æ—Ç–≤–µ—Ç–æ–≤ (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞ —Ç–µ–∫—Å—Ç–∞)
    ENABLE_STREAMING = os.environ.get('ENABLE_STREAMING', 'False').lower() == 'true'

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
    ENABLE_HISTORY = os.environ.get('ENABLE_HISTORY', 'True').lower() == 'true'

    # ===== –ü—Ä–æ—Ñ–∏–ª–∏ –±–æ—Ç–æ–≤ =====
    # –ö–∞–∂–¥–æ–≥–æ –±–æ—Ç–∞ –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
    # –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã—Ö –±–æ—Ç–æ–≤ –Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏

    # Twitter-—Å—Ç—Ä–∞—Ç–µ–≥
    ENABLE_OLIVER = os.environ.get('ENABLE_OLIVER', 'True').lower() == 'true'

    # Python-–∏–Ω–∂–µ–Ω–µ—Ä
    ENABLE_ISAAC = os.environ.get('ENABLE_ISAAC', 'True').lower() == 'true'

    # –Ø–Ω–¥–µ–∫—Å.–î–∏—Ä–µ–∫—Ç
    ENABLE_ARSENIY = os.environ.get('ENABLE_ARSENIY', 'True').lower() == 'true'

    # Google Ads
    ENABLE_VICTOR = os.environ.get('ENABLE_VICTOR', 'True').lower() == 'true'

    # –î—Ä—É–≥ –∏ –º–µ–Ω—Ç–æ—Ä
    ENABLE_MARK = os.environ.get('ENABLE_MARK', 'True').lower() == 'true'

    # Telegram
    ENABLE_TEO = os.environ.get('ENABLE_TEO', 'True').lower() == 'true'

    # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤
    ENABLE_ADAM = os.environ.get('ENABLE_ADAM', 'True').lower() == 'true'

    # iOS —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
    ENABLE_STEVE = os.environ.get('ENABLE_STEVE', 'True').lower() == 'true'

    # –£–∏–ª–ª –ö—É–ø–µ—Ä (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫)
    ENABLE_WILL = os.environ.get('ENABLE_WILL', 'True').lower() == 'true'

    # –ü–æ—É–ª –ö—É–ø–µ—Ä (–ø—Ä–æ–¥–∞–∫—Ç-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç)
    ENABLE_PAUL = os.environ.get('ENABLE_PAUL', 'True').lower() == 'true'

    # ===== –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã =====
    # –†–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è (—Å–∞–π—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)
    MAINTENANCE_MODE = os.environ.get('MAINTENANCE_MODE', 'False').lower() == 'true'

    # –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–µ–∂–∏–º–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
    MAINTENANCE_MESSAGE = os.environ.get(
        'MAINTENANCE_MESSAGE',
        'üöß –í–µ–¥—É—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã. –°–∫–æ—Ä–æ –≤–µ—Ä–Ω–µ–º—Å—è!'
    )

    # –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (–≤–∫–ª—é—á–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏)
    DEBUG_FEATURES = os.environ.get('DEBUG_FEATURES', 'False').lower() == 'true'

    # ===== –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ =====
    # –î–ª—è A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    EXPERIMENTAL_CHAT_UI = os.environ.get('EXPERIMENTAL_CHAT_UI', 'False').lower() == 'true'
    EXPERIMENTAL_ANALYTICS = os.environ.get('EXPERIMENTAL_ANALYTICS', 'False').lower() == 'true'

    @classmethod
    def get_enabled_profiles(cls) -> List[str]:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ ID –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π.

        Returns:
            List[str]: –°–ø–∏—Å–æ–∫ bot_id –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        """
        enabled = []

        # –°–ª–æ–≤–∞—Ä—å –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –∏ –∏—Ö —Ñ–ª–∞–≥–æ–≤
        profiles = [
            ('oliver', cls.ENABLE_OLIVER),
            ('isaac', cls.ENABLE_ISAAC),
            ('arseniy', cls.ENABLE_ARSENIY),
            ('victor', cls.ENABLE_VICTOR),
            ('mark', cls.ENABLE_MARK),
            ('teo', cls.ENABLE_TEO),
            ('adam', cls.ENABLE_ADAM),
            ('steve', cls.ENABLE_STEVE),
            ('will', cls.ENABLE_WILL),
            ('paul', cls.ENABLE_PAUL),
        ]

        for profile_id, enabled_flag in profiles:
            if enabled_flag:
                enabled.append(profile_id)

        logger.debug(f"–í–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏: {', '.join(enabled)}")
        return enabled
    @classmethod
    def get_all_flags(cls) -> Dict[str, bool]:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å–æ –≤—Å–µ–º–∏ —Ñ–ª–∞–≥–∞–º–∏.

        Returns:
            Dict[str, bool]: –í—Å–µ —Ñ–ª–∞–≥–∏ –∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è

        –ü—Ä–∏–º–µ—Ä:
            flags = FeatureConfig.get_all_flags()
            if flags['ENABLE_WILL']:
                print("–£–∏–ª–ª –¥–æ—Å—Ç—É–ø–µ–Ω")
        """
        return {
            key: value for key, value in cls.__dict__.items()
            if key.startswith('ENABLE_') or key.startswith('EXPERIMENTAL_')
            and not key.startswith('_')  # –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
        }

    @classmethod
    def check_maintenance(cls) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤–∫–ª—é—á–µ–Ω –ª–∏ —Ä–µ–∂–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.

        Returns:
            bool: True –µ—Å–ª–∏ —Å–∞–π—Ç –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏

        –ü—Ä–∏–º–µ—Ä:
            if FeatureConfig.check_maintenance():
                return "Maintenance", 503
        """
        if cls.MAINTENANCE_MODE:
            logger.warning(f"–°–∞–π—Ç –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏: {cls.MAINTENANCE_MESSAGE}")
            return True
        return False

    @classmethod
    def is_profile_enabled(cls, bot_id: str) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤–∫–ª—é—á–µ–Ω –ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å.

        Args:
            bot_id (str): –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–æ—Ç–∞ ('oliver', 'will', ...)

        Returns:
            bool: True –µ—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –≤–∫–ª—é—á–µ–Ω

        –ü—Ä–∏–º–µ—Ä:
            if FeatureConfig.is_profile_enabled('will'):
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –£–∏–ª–ª–∞
        """
        flag_name = f"ENABLE_{bot_id.upper()}"
        return getattr(cls, flag_name, False)

    @classmethod
    def get_feature_status(cls) -> Dict[str, Any]:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.

        Returns:
            Dict[str, Any]: –°—Ç–∞—Ç—É—Å —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö
        """
        enabled_profiles = cls.get_enabled_profiles()

        return {
            'maintenance': cls.MAINTENANCE_MODE,
            'maintenance_message': cls.MAINTENANCE_MESSAGE,
            'enabled_profiles': enabled_profiles,
            'profiles_count': len(enabled_profiles),
            'total_profiles': 9,  # –≤—Å–µ–≥–æ 9 –ø—Ä–æ—Ñ–∏–ª–µ–π
            'features': {
                '2fa': cls.ENABLE_2FA,
                'telegram': cls.ENABLE_TELEGRAM,
                'google_sheets': cls.ENABLE_GOOGLE_SHEETS,
                'deepseek': cls.ENABLE_DEEPSEEK,
                'streaming': cls.ENABLE_STREAMING,
                'history': cls.ENABLE_HISTORY,
                'debug': cls.DEBUG_FEATURES,
            },
            'experimental': {
                'chat_ui': cls.EXPERIMENTAL_CHAT_UI,
                'analytics': cls.EXPERIMENTAL_ANALYTICS,
            }
        }